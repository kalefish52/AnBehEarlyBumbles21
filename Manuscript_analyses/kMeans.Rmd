---
title: "kMeans"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Load Packages
```{r}
library(tidyverse)
if(!require(plotly)){install.packages("plotly")}
library(plotly)
```
### Load Data
```{r}
count_data <- read.csv("/Users/ericasarro/Documents/UCR_Code/SarroFisher/Manuscript_analyses/count_data.csv")
count_data

```



# K Means Cluster Analyses -- determine whether points cluster into two or more groups
```{r find number of clusters in k means}
## Elbow Method for finding the optimal number of clusters
## dunno waht this does
set.seed(123)

## Compute and plot total within sum of squares for k = 2 to k = 10.
k.max <- 10
## make sure the subset of count_data here includes feedsbrood, nectarforage, pollenforage, egglay
data <- count_data[, 4:6]
wss <- sapply(1:k.max, 
              function(k){kmeans(data, k, nstart=50, iter.max = 7)$tot.withinss})
wss
plot(1:k.max, wss,
     type="b", pch = 19, frame = FALSE, 
     xlab="Number of clusters K",
     ylab="Total within-clusters sum of squares")
```

```{r run k means analysis}
## dunno what this means
set.seed(20)

## set k based on where elbow is in above graph
k <- 3

## run k means test
## make sure subset includes broodfeed, nectarforage, pollenforage, egglay
test <- kmeans(count_data[, 4:6], k, nstart = 20)
test
```

```{r graph k means analysis} 
## make cluster a factor so we can graph with it
count_data$cluster <- as.factor(test$cluster)

## graph the data in 3d
plot_ly(x = count_data$feedsbrood, 
        y = count_data$nectarforaging, 
        z = count_data$pollenforaging, 
        type="scatter3d", 
        mode="markers", 
        color = count_data$cluster)%>%
  layout(
    title = "k means clustering",
    scene = list(
      xaxis = list(title = "feedsbrood"),
      yaxis = list(title = "nectarforaging"),
      zaxis = list(title = "pollenforaging")
      )
  )
```
                     