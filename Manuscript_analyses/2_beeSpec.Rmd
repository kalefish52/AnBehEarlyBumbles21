---
title: "beeSpec"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
#knitr::opts_chunk$set(fig.width=3, fig.height=5) # use only to create multipanel plot
```

# load packages
```{r}
library(tidyverse)
library(plyr)
library(dplyr)
library(ggplot2)
library(factoextra)
library(vegan) 
library(lme4)
library(plotly)
library(multcomp) # glht tukey
library(sjPlot)   # tab_model
library(ggpubr)   # ggdensity
library(effects)  # plot output of glmm
library(MuMIn)    # model.sel
```

# load data
```{r}
# pooled data across timepoints, values are counts
# includes all bees, but only known bees with >=3 observations have shannon values
count_data <- read.csv("../Data/filtData/count_data.csv") 

# remove queens
count_data <- count_data[count_data$caste == "W",]
count_replac <- count_data[count_data$beeType == "replac",]
count_replac <- count_replac[!is.na(count_replac$beeID),]
count_replac

count_orig <- count_data[count_data$beeType == "orig",]
count_orig <- count_orig[!is.na(count_orig$beeID),]
count_orig

ggplot(count_data, aes(x = nBehavs, y = beeType)) +
  geom_point()

mean(count_replac$nBehavs)
sd(count_replac$nBehavs)/sqrt(nrow(count_replac))

mean(count_orig$nBehavs)
sd(count_orig$nBehavs)/sqrt(nrow(count_orig))

#How many included?
count_data %>% filter(lazy=="notLazy") %>% nrow()

#How many not included, lazy? 
count_data %>% filter(lazy=="lazy") %>% nrow()


```

# count number of shannon specialists
```{r}

nrow(count_data[count_data$specBehav == "nectarforaging",])
nrow(count_data[count_data$specBehav == "pollenforaging",])
nrow(count_data[count_data$specBehav == "feedsbrood",])
nrow(count_data[count_data$specBehav == "egglaying",])
nrow(count_data[count_data$specBehav == "generalist",])
nrow(count_data[count_data$specBehav == "lazy",])
nrow(count_data)

```

# visualize body size in relation to behavioral specialization
```{r}
count_data$specBehav <- ordered(count_data$specBehav, levels = c("lazy", "generalist", "nectarforaging", "feedsbrood", "egglaying"))
p1 <- ggplot(data = count_data, aes(size, specBehav, color = shannon, shape = caste)) +
  geom_point(position = position_jitter(width=0.1, height=0.2)) +
  stat_summary(fun = mean, geom = "point", size = 5) +
  scale_shape_manual(values = c(1, 16)) +
  scale_color_gradient(low="dark blue", high="yellow") +
  # scale_color_manual(values = c("#F8766D", "#7CAE00", "#00BFC4", "#8c8c8c", "#ffc425")) +
  labs(x = "body size", y = "behavioral specialization", color = "shannon")
p1
ggsave("../figures/bodySize.jpg")
```

# visualize ovary development in relation to behavioral specialization
```{r}
# OVARY LENGTH
ggplot(data = count_data, aes(ovLavg, specBehav, color = shannon)) +
  geom_point(position = position_jitter(width=0.1, height=0.2), alpha = 0.8) +
  stat_summary(fun = mean, geom = "point", size = 5) +
  scale_color_gradient(low="dark blue", high="yellow") +
  # scale_color_manual(values = c("#F8766D", "#7CAE00", "#00BFC4", "grey", "black")) +
  labs(x = "ovary length", y = "behavioral specialization", color = "behavioral specialization")
ggsave("../figures/ovaryLength.jpg")


# OVARY STAGE (resorbed oocytes = stage 4)
p2 <- ggplot(data = count_data, aes(ovSavg, specBehav, color = shannon)) +
  geom_point(position = position_jitter(width=0.1, height=0.2), alpha = 0.8) +
  stat_summary(fun = mean, geom = "point", size = 5) +
  scale_color_gradient(low="dark blue", high="yellow") +
  # scale_color_manual(values = c("#F8766D", "#7CAE00", "#00BFC4", "#8c8c8c", "#ffc425")) +
  labs(x = "ovary stage", y = "behavioral specialization", color = "shannon")
p2
ggsave("../figures/ovaryStage.jpg")


# OOCYTE RESORPTION - similar trends
p3 <- ggplot(data = count_data, aes(ovRavg, specBehav, color = shannon)) +
  geom_point(position = position_jitter(width=0.1, height=0.2), alpha = 0.8) +
  stat_summary(fun = mean, geom = "point", size = 5) +
  scale_color_gradient(low="dark blue", high="yellow") +
  # scale_color_manual(values = c("#F8766D", "#7CAE00", "#00BFC4", "#8c8c8c", "#ffc425")) +
  labs(x = "resorption status", y = "behavioral specialization", color = "shannon")
p3
ggsave("../figures/ovarResorb.jpg")
```

```{r}
ggarrange(p1, p2, p3, nrow = 3, labels = c("A", "B", "C"))
ggsave("../figures/behavSpecBSov.jpg")
```

# Shannon Threshold
## Models
```{r}
#Body Size 
hist(count_data$size)

s0 <- glmer(size ~ 1 + (1|natal) + (1|nestTYPE:nestID), data = count_data)
s1 <- glmer(size ~ specBehav + (1|natal) + (1|nestTYPE:nestID), data = count_data)

model.sel(s0, s1)
# Behavioral group not included in best model 

#Ovary Resporption 
hist(count_data$ovRavg)
s0 <- glmer(ovRavg ~ 1 + (1|natal) + (1|nestTYPE:nestID), data = count_data)
s1 <- glmer(ovRavg ~ specBehav + (1|natal) + (1|nestTYPE:nestID), data = count_data)

model.sel(s0, s1)

#Ovary Stage 
hist(count_data$ovSavg)
s0 <- glmer(ovSavg ~ 1 + (1|natal) + (1|nestTYPE:nestID), data = count_data)
s1 <- glmer(ovSavg ~ specBehav + (1|natal) + (1|nestTYPE:nestID), data = count_data)

model.sel(s0, s1)
```
## Models for workers only
```{r}
# look only at workers
count_workers <- count_data[count_data$caste == "W",]

#Body Size 
hist(count_workers$size)

s0 <- glmer(size ~ 1 + (1|natal) + (1|nestID), data = count_workers)
s1 <- glmer(size ~ specBehav + (1|natal) + (1|nestID), data = count_workers)

model.sel(s0, s1)
# Behavioral group not included in best model 

#Ovary Resporbtion 
hist(count_data$ovRavg)
s0 <- glmer(ovRavg ~ 1 + (1|natal) + (1|nestID), data = count_workers)
s1 <- glmer(ovRavg ~ specBehav + (1|natal) + (1|nestID), data = count_workers)

model.sel(s0, s1)

#Ovary Stage 
hist(count_data$ovSavg)
s0 <- glmer(ovSavg ~ 1 + (1|natal) + (1|nestID), data = count_workers)
s1 <- glmer(ovSavg ~ specBehav + (1|natal) + (1|nestID), data = count_workers)

model.sel(s0, s1)
```


# Highest Counts
## Analysis based on highest number of tasks workers perform 
```{r}
head(count_data)
#filter so all bees have >= 3 behaviors (exclude lazies)
high_behav<-count_data %>% filter(lazy=="notLazy") 
nrow(high_behav)
highbehav<-high_behav %>% dplyr::select(beeID, nectarforaging, 
                                 feedsbrood, pollenforaging, egglaying)

hbdf<-highbehav %>% pivot_longer(!beeID, names_to="Behavior", values_to="count")

#Sort each bee by which behavior they do the most and then assign that bee to that behavior
BehavAssign<-hbdf %>% group_by(beeID) %>% arrange(beeID, desc(count)) %>% slice_head() %>% mutate(BehavAssign=Behavior) %>% dplyr::select(beeID, BehavAssign)

#Merge back into original dataframe
FinalBehavRank<-left_join(high_behav, BehavAssign, by="beeID")
FinalBehavRank$BehavAssign <-as.factor(FinalBehavRank$BehavAssign.x)
FinalBehavRank
BehavAssign

#How many bees are in each category? 
paste("nectar", nrow(FinalBehavRank[FinalBehavRank$BehavAssign == "nectarforaging",]))
paste("pollen", nrow(FinalBehavRank[FinalBehavRank$BehavAssign == "pollenforaging",]))
paste("feed", nrow(FinalBehavRank[FinalBehavRank$BehavAssign == "feedsbrood",]))
paste("egg", nrow(FinalBehavRank[FinalBehavRank$BehavAssign == "egglaying",]))

#add highest count to count_data
count_data <- left_join(count_data, BehavAssign, by="beeID")
write.csv(count_data, "../Data/filtData/count_data.csv")

#plot
ggplot(FinalBehavRank, aes(BehavAssign)) + geom_bar()

p2 <- ggplot(data = count_data, aes(ovSavg, specBehav, color = shannon)) +
  geom_point(position = position_jitter(width=0.1, height=0.2), alpha = 0.8) +
  stat_summary(fun = mean, geom = "point", size = 5) +
  scale_color_gradient(low="dark blue", high="yellow") +
  # scale_color_manual(values = c("#F8766D", "#7CAE00", "#00BFC4", "#8c8c8c", "#ffc425")) +
  labs(x = "ovary stage", y = "behavioral specialization", color = "shannon") 


ggsave("../figures/highcountdistribution.jpg")

#Run GLMMs using BehavAssign as a grouping variable 

B1<-ggplot(FinalBehavRank, aes(BehavAssign, size, color = caste, shape = nestTYPE)) +
  geom_point(position = position_jitter(width=0.1, height=0.05), alpha = 0.5) +
  stat_summary(fun = mean, geom = "point", size = 5) + scale_color_manual(values = c("aquamarine3", "darkslateblue")) + xlab("Most Frequently Performed Task") + 
  ylab("Body Size")
B1
ggsave("../figures/highcountBS.jpg")

FinalBehavRank %>% dplyr::select(BehavAssign, beeID, ovSavg)
B2<-ggplot(FinalBehavRank, aes(BehavAssign, ovSavg, color = caste, shape = nestTYPE)) +
  geom_point(position = position_jitter(width=0.1, height=0.05), alpha = 0.5) +
  stat_summary(fun = mean, geom = "point", size = 5) +scale_color_manual(values = c("aquamarine3", "darkslateblue"))+ xlab("Most Frequently Performed Task") + 
  ylab("Average Ovary \n Development")

B3<-ggplot(FinalBehavRank, aes(BehavAssign, ovRavg, color = caste, shape = nestTYPE)) +
  geom_point(position = position_jitter(width=0.1, height=0.05), alpha = 0.5) +
  stat_summary(fun = mean, geom = "point", size = 5) +scale_color_manual(values = c("aquamarine3", "darkslateblue"))+ xlab("Most Frequently Performed Task") + 
  ylab("Average Ovary Resporption")


ggsave("../figures/highcountOV.jpg")

ggarrange(B1, B2, labels = c("A", "B"), ncol=1, common.legend=TRUE, legend="right") 
ggsave("../figures/highcountsAll.jpg")


```

## Models
```{r}
#Body Size 
hist(FinalBehavRank$size)
head(FinalBehavRank)

s0 <- glmer(size ~ 1 + (1|natal) + (1|nestTYPE:nestID), data = FinalBehavRank)
s1 <- glmer(size ~ BehavAssign + (1|natal) + (1|nestTYPE:nestID), data = FinalBehavRank)

model.sel(s0, s1)
# Behavioral group not included in best model 

#Ovary Resporbtion 
hist(FinalBehavRank$ovRavg)
s0 <- glmer(ovRavg ~ 1 + (1|natal) + (1|nestTYPE:nestID), data = FinalBehavRank)
s1 <- glmer(ovRavg ~ BehavAssign + (1|natal) + (1|nestTYPE:nestID), data = FinalBehavRank)

model.sel(s0, s1)

#Ovary Stage 
hist(FinalBehavRank$ovSavg)
s0 <- glmer(ovSavg ~ 1 + (1|natal) + (1|nestTYPE:nestID), data = FinalBehavRank)
s1 <- glmer(ovSavg ~ BehavAssign + (1|natal) + (1|nestTYPE:nestID), data = FinalBehavRank)

model.sel(s0, s1)

#Behaviorlal assign not included in any of the best models 
```
## Models for workers only
```{r}
# remove queens
FinalBehavRankW <- FinalBehavRank[FinalBehavRank$caste == "W",]

#Body Size 
hist(FinalBehavRankW$size)

s0 <- glmer(size ~ 1 + (1|natal) + (1|nestTYPE:nestID), data = FinalBehavRankW)
s1 <- glmer(size ~ BehavAssign + (1|natal) + (1|nestTYPE:nestID), data = FinalBehavRankW)

model.sel(s0, s1)
# Behavioral group not included in best model 

#Ovary Resporbtion 
hist(FinalBehavRankW$ovRavg)
s0 <- glmer(ovRavg ~ 1 + (1|natal) + (1|nestTYPE:nestID), data = FinalBehavRankW)
s1 <- glmer(ovRavg ~ BehavAssign + (1|natal) + (1|nestTYPE:nestID), data = FinalBehavRankW)

model.sel(s0, s1)

#Ovary Stage 
hist(FinalBehavRankW$ovSavg)
s0 <- glmer(ovSavg ~ 1 + (1|natal) + (1|nestTYPE:nestID), data = FinalBehavRankW)
s1 <- glmer(ovSavg ~ BehavAssign + (1|natal) + (1|nestTYPE:nestID), data = FinalBehavRankW)

model.sel(s0, s1)

#Behaviorlal assign not included in any of the best models 
```


# Perfectly specialized counts- size and ovaries 
```{r}
# subset to look only at perfectly specialized individuals
perfSpec <- count_data %>% filter(lazy=="notLazy") %>% filter(shannon=="0")
# How many bees perform more than one task? 
1-nrow(perfSpec)/nrow(count_data)

nrow(perfSpec[perfSpec$specBehav == "nectarforaging",])
nrow(perfSpec[perfSpec$specBehav == "pollenforaging",])
nrow(perfSpec[perfSpec$specBehav == "feedsbrood",])
nrow(perfSpec[perfSpec$specBehav == "egglaying",])

perfgraph<-perfSpec %>% dplyr::select(specBehav, beeID, ovSavg)
perfgraph <-perfgraph[complete.cases(perfgraph),]

perfSpec

# add perfSpec to count_data
count_data$perfSpec <- NA
for (i in 1:nrow(count_data)) {
  if (is.na(count_data$specProp[i])) {
  } else if (count_data$specProp[i] == 1) {
    count_data$perfSpec[i] <- count_data$specBehav[i] 
    }
}
count_data
# write count_data for nmds graphs
write.csv(count_data, "../Data/filtData/count_data.csv")

graphperfSpec<-perfgraph %>% group_by(specBehav) %>% 
  mutate(aov=mean(ovSavg))  %>% 
  mutate(sdov=sd(ovSavg)) %>% 
  dplyr::select(specBehav, aov, sdov) %>% unique()
graphperfSpec

perfov<-ggplot(graphperfSpec, aes(x=specBehav, y=aov)) +
    geom_bar(stat="identity", position=position_dodge(), colour="black") + 
  geom_errorbar(aes(ymin=aov-sdov,  ymax=aov+sdov))
perfov

```


## Models 
```{r}
#Body Size 
hist(perfSpec$size)

s0 <- glmer(size ~ 1 + (1|natal) + (1|nestTYPE:nestID) + (1|caste), data = perfSpec)
s1 <- glmer(size ~ specBehav + (1|natal) + (1|nestTYPE:nestID) + (specBehav|caste), data = perfSpec)

model.sel(s0, s1)

#Ovary Resporbtion 
hist(perfSpec$ovRavg)
s0 <- glmer(ovRavg ~ 1 + (1|natal) + (1|nestTYPE:nestID) + (1|caste), data = perfSpec)
s1 <- glmer(ovRavg ~ specBehav + (1|natal) + (1|nestTYPE:nestID) + (specBehav|caste), data = perfSpec)

model.sel(s0, s1)

#Ovary Stage 
hist(perfSpec$ovSavg)
s0 <- glmer(ovSavg ~ 1 + (1|natal) + (1|nestTYPE:nestID) + (1|caste), data = perfSpec)
s1 <- glmer(ovSavg ~ specBehav + (1|natal) + (1|nestTYPE:nestID) + (specBehav|caste), data = perfSpec)

model.sel(s0, s1)

mymodel <- s1
summary(mymodel)
tab_model(mymodel)
plot(allEffects(mymodel))

# plot model residuals
plot(fitted(mymodel), residuals(mymodel), xlab = "Fitted Values", ylab = "Residuals")
abline(h = 0, lty = 2)
lines(smooth.spline(fitted(mymodel), residuals(mymodel)))

posthoc<-glht(s1, linfct = mcp(specBehav = "Tukey"))
summary(posthoc)
perfSpec$nestTYPE=as.factor(perfSpec$nestTYPE)
perfSpec$caste=as.factor(perfSpec$caste)

C1<-ggplot(data = perfSpec, aes(specBehav, ovSavg, color = caste, shape=nestTYPE)) +
  geom_point(position = position_jitter(width = 0.1, height = 0.1), size = 2, alpha = 0.7) +labs(x = "Perfectly Specialized Behavior", y = "Average Ovary \n Stage", shape = "Nest Configuration")+ stat_summary(fun = mean, geom = "point", size = 5)+ scale_color_manual(values = c("aquamarine3", "darkslateblue"))
ggsave("../figures/osperfectlyspecialized.jpg")


```
## Models for workers only
```{r}
perfSpecW <- perfSpec[perfSpec$caste == "W",]

#Body Size 
hist(perfSpecW$size)

s0 <- glmer(size ~ 1 + (1|natal) + (1|nestTYPE:nestID), data = perfSpecW)
s1 <- glmer(size ~ specBehav + (1|natal) + (1|nestTYPE:nestID), data = perfSpecW)

model.sel(s0, s1)

#Ovary Resporbtion 
hist(perfSpecW$ovRavg)
s0 <- glmer(ovRavg ~ 1 + (1|natal) + (1|nestTYPE:nestID), data = perfSpecW)
s1 <- glmer(ovRavg ~ specBehav + (1|natal) + (1|nestTYPE:nestID), data = perfSpecW)

model.sel(s0, s1)

#Ovary Stage 
hist(perfSpecW$ovSavg)
s0 <- glmer(ovSavg ~ 1 + (1|natal) + (1|nestTYPE:nestID), data = perfSpecW)
s1 <- glmer(ovSavg ~ specBehav + (1|natal) + (1|nestTYPE:nestID), data = perfSpecW)

model.sel(s0, s1)
```

# Single instance of behavior 
```{r}
# subset to look only at nonlazy individuals
single <- count_data %>% filter(lazy=="notLazy") 

# add columns for presence/absence data
single$NF <- "no"
single$PF <- "no"
single$FB <- "no"
single$EL <- "no"

# go through each individual and update presence/absence data for each behavior
for (i in 1:nrow(single)) {
  if (single$nectarforaging[i] > 0) {
    single$NF[i] <- "yes"
  }
  if (single$pollenforaging[i] > 0) {
    single$PF[i] <- "yes"
  }
  if (single$feedsbrood[i] > 0) {
    single$FB[i] <- "yes"
  }
  if (single$egglaying[i] > 0) {
    single$EL[i] <- "yes"
  }
}

count_data$NF <- NA
count_data$PF <- NA
count_data$FB <- NA
count_data$EL <- NA

for(i in 1:nrow(count_data)) {
  for(j in 1:nrow(single)) {
    if(count_data$beeID[i] == single$beeID[j]) {
      count_data$NF[i] <- single$NF[j]
      count_data$PF[i] <- single$PF[j]
      count_data$FB[i] <- single$FB[j]
      count_data$EL[i] <- single$EL[j]
    }
  }
}

write.csv(count_data, "../Data/filtData/count_data.csv")
count_data

# print the number of bees that performed each task
print(paste(nrow(single[single$NF == "yes",]), "nectar foragers from", length(unique(single$nestID[single$NF == "yes"])), "nests"))
print(paste(nrow(single[single$PF == "yes",]), "pollen foragers from", length(unique(single$nestID[single$PF == "yes"])), "nests"))
print(paste(nrow(single[single$FB == "yes",]), "brood feeders from", length(unique(single$nestID[single$FB == "yes"])), "nests"))
print(paste(nrow(single[single$EL == "yes",]), "egg layers from", length(unique(single$nestID[single$EL == "yes"])), "nests"))

print(paste(length(unique(single$nestID)), "total nests"))
41/21

graphSingleOv <- single %>% dplyr::select(NF, PF, FB, EL, beeID, ovSavg, caste)
graphSingleOv <-graphSingleOv[complete.cases(graphSingleOv),]

graphSingleSize <- single %>% dplyr::select(NF, PF, FB, EL, beeID, size, caste)
graphSingleSize <-graphSingleSize[complete.cases(graphSingleSize),]


ggplot(graphSingleSize) +
  geom_point(aes(x = caste, y = size, size = EL, shape = FB, color = PF, fill = NF),
             position = position_jitter(width = 0.4, height = 0.1),
             alpha = 0.6) +
  scale_shape_manual(values = c(21, 24))

ggplot(graphSingleOv) +
  geom_point(aes(x = caste, y = ovSavg, size = EL, shape = FB, color = PF, fill = NF),
             position = position_jitter(width = 0.4, height = 0.1),
             alpha = 0.6) +
  scale_shape_manual(values = c(21, 24))

egglayers <- single[single$EL == "yes",]
egglayers[egglayers$caste == "Q",]
46

```


## Models 
```{r}
#Body Size 
s0 <- glmer(size ~ 1 + (1|natal) + (1|nestTYPE:nestID) + (1|caste), data = single)
s1 <- glmer(size ~ FB + PF + NF + EL + (1|natal) + (1|nestTYPE:nestID) + (EL|caste), data = single)

model.sel(s0, s1)

#Ovary Resporbtion 
s0 <- glmer(ovRavg ~ 1 + (1|natal) + (1|nestTYPE:nestID) + (1|caste), data = single)
s1 <- glmer(ovRavg ~ FB + PF + NF + EL + (1|natal) + (1|nestTYPE:nestID) + (EL|caste), data = single)

model.sel(s0, s1)

#Ovary Stage 
s0 <- glmer(ovSavg ~ 1 + (1|natal) + (1|nestTYPE:nestID) + (1|caste), data = single)
s1 <- glmer(ovSavg ~ FB + PF + NF + EL + (1|natal) + (1|nestTYPE:nestID) + (EL|caste), data = single)

model.sel(s0, s1)

# plot model residuals
plot(fitted(mymodel), residuals(mymodel), xlab = "Fitted Values", ylab = "Residuals")
abline(h = 0, lty = 2)
lines(smooth.spline(fitted(mymodel), residuals(mymodel)))

posthoc<-glht(s1, linfct = mcp(specBehav = "Tukey"))
summary(posthoc)
perfSpec$nestTYPE=as.factor(perfSpec$nestTYPE)
perfSpec$caste=as.factor(perfSpec$caste)

C1<-ggplot(data = perfSpec, aes(specBehav, ovSavg, color = caste, shape=nestTYPE)) +
  geom_point(position = position_jitter(width = 0.1, height = 0.1), size = 2, alpha = 0.7) +labs(x = "Perfectly Specialized Behavior", y = "Average Ovary \n Stage", shape = "Nest Configuration")+ stat_summary(fun = mean, geom = "point", size = 5)+ scale_color_manual(values = c("aquamarine3", "darkslateblue"))
ggsave("../figures/osperfectlyspecialized.jpg")


```
## Models for workers only
```{r}
perfSpecW <- perfSpec[perfSpec$caste == "W",]

#Body Size 
hist(perfSpecW$size)

s0 <- glmer(size ~ 1 + (1|natal) + (1|nestTYPE:nestID), data = perfSpecW)
s1 <- glmer(size ~ specBehav + (1|natal) + (1|nestTYPE:nestID), data = perfSpecW)

model.sel(s0, s1)

#Ovary Resporbtion 
hist(perfSpecW$ovRavg)
s0 <- glmer(ovRavg ~ 1 + (1|natal) + (1|nestTYPE:nestID), data = perfSpecW)
s1 <- glmer(ovRavg ~ specBehav + (1|natal) + (1|nestTYPE:nestID), data = perfSpecW)

model.sel(s0, s1)

#Ovary Stage 
hist(perfSpecW$ovSavg)
s0 <- glmer(ovSavg ~ 1 + (1|natal) + (1|nestTYPE:nestID), data = perfSpecW)
s1 <- glmer(ovSavg ~ specBehav + (1|natal) + (1|nestTYPE:nestID), data = perfSpecW)

model.sel(s0, s1)
```


<!-- ## Body Size  -->
<!-- ```{r} -->
<!-- # MODEL SIZE  -->
<!-- hist(perfSpec$size) -->

<!-- s0 <- glmer(size ~ 1 + (1|natal) + (1|nestID), -->
<!--               data = perfSpec) -->
<!-- s1 <- glmer(size ~ specBehav + ovSavg + ovRavg + queen + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s3 <- glmer(size ~ specBehav + ovSavg + ovRavg + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s4 <- glmer(size ~ specBehav + ovSavg + queen + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s5 <- glmer(size ~ specBehav + ovSavg + queen + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s6 <- glmer(size ~ specBehav + ovSavg + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s7 <- glmer(size ~ specBehav + ovRavg + queen + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s8 <- glmer(size ~ specBehav + ovRavg + queen + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s9 <- glmer(size ~ specBehav + ovRavg + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s10 <- glmer(size ~ ovSavg + ovRavg + queen + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s11 <- glmer(size ~ ovSavg + ovRavg + queen + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s12 <- glmer(size ~ ovSavg + ovRavg + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s13 <- glmer(size ~ specBehav + ovSavg + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s14 <- glmer(size ~ specBehav + ovRavg + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s15 <- glmer(size ~ ovSavg + ovRavg + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s16 <- glmer(size ~ specBehav + queen + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s17 <- glmer(size ~ specBehav + queen + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s18 <- glmer(size ~ specBehav + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s19 <- glmer(size ~ ovSavg + queen + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s20 <- glmer(size ~ ovSavg + queen + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s21 <- glmer(size ~ ovSavg + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s22 <- glmer(size ~ ovRavg + queen + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s23 <- glmer(size ~ ovRavg + queen + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s24 <- glmer(size ~ ovRavg + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s25 <- glmer(size ~ specBehav + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s26 <- glmer(size ~ ovSavg + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s27 <- glmer(size ~ ovRavg + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s28 <- glmer(size ~ queen + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s29 <- glmer(size ~ queen + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s30 <- glmer(size ~ nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- model.sel(s0, s1, s2, s3, s4, s5, s6, s7, s8, s9, s10, s11, s12, s13, s14, s15, s16, s17, s18, s19, s20, s21, s22, s23, s24, s25, s26, s27, s28, s29, s30) -->

<!-- s01 <- lmer(size ~ specBehav + (1|nestTYPE) + (1|nestID) + (1|natal) + (1|caste), -->
<!--               data = perfSpec) -->

<!-- mymodel <- s01 -->
<!-- summary(mymodel) -->
<!-- tab_model(mymodel) -->
<!-- plot(allEffects(mymodel)) -->

<!-- # plot model residuals -->
<!-- plot(fitted(mymodel), residuals(mymodel), xlab = "Fitted Values", ylab = "Residuals") -->
<!-- abline(h = 0, lty = 2) -->
<!-- lines(smooth.spline(fitted(mymodel), residuals(mymodel))) -->

<!-- posthoc<-glht(s01, linfct = mcp(specBehav = "Tukey")) -->
<!-- summary(posthoc) -->


<!-- # plot size against behavioral specialization  -->

<!-- C2<-ggplot(data = perfSpec, aes(specBehav, size, color = caste, shape=nestTYPE)) + -->
<!--   geom_point(position = position_jitter(width = 0.1, height = 0.1), size = 2, alpha = 0.7) +labs(x = "Perfectly Specialized Behavior", y = "Body Size", shape = "Nest Configuration")+ stat_summary(fun = mean, geom = "point", size = 5)+ scale_color_manual(values = c("aquamarine3", "darkslateblue")) -->
<!-- ggsave("../figures/bsperfectlyspecialized.jpg") -->

<!-- ggarrange(C2, C1, labels = c("A", "B"), ncol=1, common.legend=TRUE, legend="right") -->
<!-- ggsave("../figures/perfectcountsAll.jpg") -->


<!-- ``` -->


<!-- ```{r} -->
<!-- # plot all -->
<!-- ggplot(data = perfSpec, aes(ovRavg, size, color = specBehav, shape = nestTYPE)) + -->
<!--   geom_point(position = position_jitter(width = 0.1, height = 0.1), size = 2, alpha = 0.7) + -->
<!--   scale_color_manual(values = c("#F8766D", "#7CAE00", "#00BFC4", "#8c8c8c", "#ffc425")) + -->
<!--   labs(x = "ovary resorption", y = "body size", color = "behavioral specialization") -->
<!-- ggsave("../figures/ovaryResVsize.jpg") -->





<!-- # MODEL OVARY STAGE -->
<!-- hist(perfSpec$ovSavg) -->

<!-- s0 <- glmer(ovSavg ~ 1 + (1|natal) + (1|nestID), -->
<!--               data = perfSpec) -->
<!-- s1 <- glmer(ovSavg ~ specBehav + size + ovRavg + queen + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s2 <- glmer(ovSavg ~ specBehav + size + ovRavg + queen + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s3 <- glmer(ovSavg ~ specBehav + size + ovRavg + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s4 <- glmer(ovSavg ~ specBehav + size + queen + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s5 <- glmer(ovSavg ~ specBehav + size + queen + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s6 <- glmer(ovSavg ~ specBehav + size + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s7 <- glmer(ovSavg ~ specBehav + ovRavg + queen + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s8 <- glmer(ovSavg ~ specBehav + ovRavg + queen + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s9 <- glmer(ovSavg ~ specBehav + ovRavg + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s10 <- glmer(ovSavg ~ size + ovRavg + queen + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s11 <- glmer(ovSavg ~ size + ovRavg + queen + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s12 <- glmer(ovSavg ~ size + ovRavg + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s13 <- glmer(ovSavg ~ specBehav + size + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s14 <- glmer(ovSavg ~ specBehav + ovRavg + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s15 <- glmer(ovSavg ~ size + ovRavg + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s16 <- glmer(ovSavg ~ specBehav + queen + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s17 <- glmer(ovSavg ~ specBehav + queen + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s18 <- glmer(ovSavg ~ specBehav + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s19 <- glmer(ovSavg ~ size + queen + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s20 <- glmer(ovSavg ~ size + queen + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s21 <- glmer(ovSavg ~ size + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s22 <- glmer(ovSavg ~ ovRavg + queen + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s23 <- glmer(ovSavg ~ ovRavg + queen + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s24 <- glmer(ovSavg ~ ovRavg + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s25 <- glmer(ovSavg ~ specBehav + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s26 <- glmer(ovSavg ~ size + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s27 <- glmer(ovSavg ~ ovRavg + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s28 <- glmer(ovSavg ~ queen + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s29 <- glmer(ovSavg ~ queen + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s30 <- glmer(ovSavg ~ nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- model.sel(s0, s1, s2, s3, s4, s5, s6, s7, s8, s9, s10, s11, s12, s13, s14, s15, s16, s17, s18, s19, s20, s21, s22, s23, s24, s25, s26, s27, s28, s29, s30) -->


<!-- st01 <- glmer(ovSavg ~ specBehav + (1|nestTYPE) + (1|nestID) + (1|natal), -->
<!--               data = perfSpec, family = gaussian(link="identity")) -->


<!-- mymodel <- st01 -->
<!-- summary(mymodel) -->
<!-- tab_model(mymodel) -->
<!-- plot(allEffects(mymodel)) -->

<!-- posthoc <- glht(mymodel, linfct = mcp(specBehav = "Tukey")) -->
<!-- posthoc -->

<!-- # plot model residuals -->
<!-- plot(fitted(mymodel), residuals(mymodel), xlab = "Fitted Values", ylab = "Residuals") -->
<!-- abline(h = 0, lty = 2) -->
<!-- lines(smooth.spline(fitted(mymodel), residuals(mymodel))) -->

<!-- ggplot(data = perfSpec, aes(ovSavg, size, color = specBehav, shape = nestTYPE)) + -->
<!--   geom_point(position = position_jitter(width = 0.15, height = 0), size = 2, alpha = 0.7) + -->
<!--   scale_color_manual(values = c("#F8766D", "#7CAE00", "#00BFC4", "#8c8c8c", "#ffc425")) + -->
<!--   labs(x = "ovary stage", y = "body size", color = "behavioral specialization") -->
<!-- ggsave("../figures/ovaryVsize.jpg") -->




<!-- # MODEL OVARY RESORPTION -->
<!-- hist(perfSpec$ovRavg) -->

<!-- s0 <- glmer(ovRavg ~ 1 + (1|natal) + (1|nestID), -->
<!--               data = perfSpec) -->
<!-- s1 <- glmer(ovRavg ~ specBehav + size + queen + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s2 <- glmer(ovRavg ~ specBehav + size + queen + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s3 <- glmer(ovRavg ~ specBehav + size + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s4 <- glmer(ovRavg ~ specBehav + size + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s5 <- glmer(ovRavg ~ specBehav + size + queen + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s6 <- glmer(ovRavg ~ specBehav + size + queen + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s7 <- glmer(ovRavg ~ specBehav + size + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s8 <- glmer(ovRavg ~ specBehav + queen + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s9 <- glmer(ovRavg ~ specBehav + queen + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s10 <- glmer(ovRavg ~ specBehav + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s11 <- glmer(ovRavg ~ size + queen + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s12 <- glmer(ovRavg ~ specBehav + size + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s13 <- glmer(ovRavg ~ specBehav + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s14 <- glmer(ovRavg ~ size + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s15 <- glmer(ovRavg ~ specBehav + queen + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s16 <- glmer(ovRavg ~ specBehav + queen + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s17 <- glmer(ovRavg ~ specBehav + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s18 <- glmer(ovRavg ~ size + queen + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s19 <- glmer(ovRavg ~ size + queen + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s20 <- glmer(ovRavg ~ size + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s21 <- glmer(ovRavg ~ queen + nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s22 <- glmer(ovRavg ~ queen + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s23 <- glmer(ovRavg ~ nBees + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s24 <- glmer(ovRavg ~ specBehav + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->
<!-- s25 <- glmer(ovRavg ~ size + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->

<!-- model.sel(s0, s1, s2, s3, s4, s5, s6, s7, s8, s9, s10, s11, s12, s13, s14, s15, s16, s17, s18, s19, s20, s21, s22, s23, s24, s25) -->

<!-- r01 <- glmer(ovRavg ~ specBehav + (1|nestTYPE) + (1|nestID) + (1|natal), -->
<!--               data = perfSpec) -->

<!-- mymodel <- r01 -->
<!-- summary(mymodel) -->
<!-- tab_model(mymodel) -->
<!-- plot(allEffects(mymodel)) -->
<!-- ``` -->

```
