---
title: "Queen Time Budgeting"
output: html_notebook
---

### Proposed Topic
Bumble bee queen task repertoire and time budget in response to the social environment.

### Acquired Data
Data includes several spreadsheets (each spreadsheet corresponding to a single colony) with the following variables:
-Observation ID
-Observaton date
-Subject
-Behavior
-Modifiers
-Behavior Type
-Start 
-Stop 
-Comments


### Questions to answer
Does the social environment impact bumble bee queen task repertoire?
-Do solitary queens perform different behaviors than social queens?

Does the social environment impact bumble bee queen time allocation? 
-Do social queens spend proportionally less time on certain tasks than solitary queens?
-Do social queens spend absolutely less time on certain tasks than solitary queens?



## Load Packages
```{r}
library(tidyverse)
```

# Load Data
```{r}

## create a list of all the files in the BORISfiles directory. these are all the files we want to import
borisfiles <- list.files("/Users/ericasarro/Google\ Drive\ File\ Stream/My\ Drive/WoodardLab.shared/Projects/2018.Awesome.Summer.Experiments/Raw\ Data/BORISfiles")

## loop over the files and import all of them. rename column names to remove "." and make shorter
lapply(borisfiles, read.csv, header = TRUE, col.names = c("obsID", "obsDate", "filename", "totalLen", "fps", "beeID", "behav", "mod", "behavType", "start", "stop", "dur", "comStart", "comStop"))

## do this to all the things 
do.call(rbind(filename))



## load a subset of data to test
all_data <- read.csv("/Users/ericasarro/Google\ Drive\ File\ Stream/My\ Drive/MasterProjects/18Su_AwesomeSummer/MockData/AggEvents.csv", header = TRUE, col.names = c("obsID", "obsDate", "filename", "totalLen", "fps", "beeID", "behav", "mod", "behavType", "start", "stop", "dur", "comStart", "comStop" ))
head(all_data)

```





# Clean Data
```{r}

## convert columns to character to better manipulate
all_data$beeID <- as.character(all_data$beeID)
all_data$obsID <- as.character(all_data$obsID)

## split out obsID into camID, nestID, dateID and hourID
all_data$camID <- sapply(strsplit(all_data$obsID, "\t"), 
                          function(x){
                            x[1]
                            } )

all_data$nestID <- sapply(strsplit(all_data$obsID, "\t"), 
                          function(x){
                            x[2]
                            } )

all_data$dateID <- sapply(strsplit(all_data$obsID, "\t"), 
                          function(x){ 
                            x[3]
                            } )

all_data$hourID <- sapply(strsplit(all_data$obsID, "\t"), 
                          function(x){ 
                            x[4]
                            } )

## subset to only queens
queen_data <- subset(all_data, startsWith(all_data$beeID, "Queen"))

## group by subject
#   **change all_data to queen_data
subj_data <- group_by(all_data, beeID)

## group by behavior
#   **change all_data to queen_data
behav_data <- group_by(subj_data, behav)

## calculate absolute amount of time spent on each behav
#for each subject: sum time carrying out each task, divide by total time 
#for total time:
#   **need to account for videos with 0 data. make sure boris output includes those
#   **need to account for multiple events in a single video -- can only sum unique obsIDs


## caclulate proportion of time spent on each behav

```





# Visualize Data
pie charts with propotional time, bar graphs with absolute
```{r}
## saves plot
ggsave(xxxx.pdf)

```





# Analyze Data
```{r}

```





